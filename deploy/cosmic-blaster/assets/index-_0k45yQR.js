(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const n of s)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&i(a)}).observe(document,{childList:!0,subtree:!0});function t(s){const n={};return s.integrity&&(n.integrity=s.integrity),s.referrerPolicy&&(n.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?n.credentials="include":s.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(s){if(s.ep)return;s.ep=!0;const n=t(s);fetch(s.href,n)}})();class o{static instance;inputState={left:!1,right:!1,shoot:!1};static getInstance(){return o.instance||(o.instance=new o),o.instance}init(){this.setupTouchControls(),this.setupKeyboardControls(),this.preventDefaultBehaviors()}setupTouchControls(){const e=document.getElementById("move-left"),t=document.getElementById("move-right"),i=document.getElementById("shoot");e.addEventListener("pointerdown",s=>{s.preventDefault(),this.inputState.left=!0}),e.addEventListener("pointerup",s=>{s.preventDefault(),this.inputState.left=!1}),e.addEventListener("pointerleave",s=>{s.preventDefault(),this.inputState.left=!1}),t.addEventListener("pointerdown",s=>{s.preventDefault(),this.inputState.right=!0}),t.addEventListener("pointerup",s=>{s.preventDefault(),this.inputState.right=!1}),t.addEventListener("pointerleave",s=>{s.preventDefault(),this.inputState.right=!1}),i.addEventListener("pointerdown",s=>{s.preventDefault(),this.inputState.shoot=!0}),i.addEventListener("pointerup",s=>{s.preventDefault(),this.inputState.shoot=!1}),i.addEventListener("pointerleave",s=>{s.preventDefault(),this.inputState.shoot=!1})}setupKeyboardControls(){document.addEventListener("keydown",e=>{switch(e.code){case"ArrowLeft":case"KeyA":this.inputState.left=!0,e.preventDefault();break;case"ArrowRight":case"KeyD":this.inputState.right=!0,e.preventDefault();break;case"Space":case"Enter":this.inputState.shoot=!0,e.preventDefault();break}}),document.addEventListener("keyup",e=>{switch(e.code){case"ArrowLeft":case"KeyA":this.inputState.left=!1,e.preventDefault();break;case"ArrowRight":case"KeyD":this.inputState.right=!1,e.preventDefault();break;case"Space":case"Enter":this.inputState.shoot=!1,e.preventDefault();break}})}preventDefaultBehaviors(){document.addEventListener("touchstart",e=>{e.touches.length>1&&e.preventDefault()},{passive:!1}),document.addEventListener("touchmove",e=>{e.preventDefault()},{passive:!1}),document.addEventListener("contextmenu",e=>{e.preventDefault()}),window.addEventListener("beforeunload",e=>{e.preventDefault(),e.returnValue=""})}getInputState(){return{...this.inputState}}reset(){this.inputState={left:!1,right:!1,shoot:!1}}}class y{engine;shootPressed=!1;constructor(e){this.engine=e}init(){this.shootPressed=!1}update(e){this.engine.getInputState().shoot&&!this.shootPressed&&(this.shootPressed=!0,this.engine.requestFullscreen(),this.engine.setState("game"))}render(e){const t=this.engine.getCanvas();e.fillStyle="#000",e.fillRect(0,0,t.width,t.height),e.fillStyle="#fff";for(let i=0;i<50;i++){const s=i*37%t.width,n=i*73%t.height;e.fillRect(s,n,1,1)}e.fillStyle="#00ff00",e.font="bold 48px Arial",e.textAlign="center",e.fillText("COSMIC BLASTER",t.width/2,t.height/2-50),e.fillStyle="#fff",e.font="24px Arial",e.fillText("Tap SHOOT to start",t.width/2,t.height/2+20),e.font="16px Arial",e.fillStyle="#ccc",e.fillText("Destroy the enemy ships!",t.width/2,t.height/2+60),e.fillText("First to lose all HP loses!",t.width/2,t.height/2+80)}cleanup(){}}class h{static instance;canvasCache=new Map;audioCache=new Map;static getInstance(){return h.instance||(h.instance=new h),h.instance}createPlayerSprite(){if(this.canvasCache.has("player"))return this.canvasCache.get("player");const e=document.createElement("canvas");e.width=32,e.height=32;const t=e.getContext("2d");return t.fillStyle="#00ff00",t.beginPath(),t.moveTo(16,4),t.lineTo(8,28),t.lineTo(16,20),t.lineTo(24,28),t.closePath(),t.fill(),t.fillStyle="#ffff00",t.fillRect(14,24,4,4),this.canvasCache.set("player",e),e}createTargetSprite(){if(this.canvasCache.has("target"))return this.canvasCache.get("target");const e=document.createElement("canvas");e.width=48,e.height=48;const t=e.getContext("2d");return t.fillStyle="#ff0000",t.fillRect(8,16,32,16),t.fillStyle="#cc0000",t.fillRect(4,20,8,8),t.fillRect(36,20,8,8),t.fillStyle="#ffff00",t.fillRect(20,18,8,4),this.canvasCache.set("target",e),e}createExplosionSprite(){if(this.canvasCache.has("explosion"))return this.canvasCache.get("explosion");const e=document.createElement("canvas");e.width=256,e.height=32;const t=e.getContext("2d");for(let i=0;i<8;i++){const s=i*32,n=4+i*2,a=1-i/8;t.globalAlpha=a,t.fillStyle=i<4?"#ffff00":"#ff8800";for(let r=0;r<6;r++){const f=s+16+Math.cos(r)*n,l=16+Math.sin(r)*n;t.fillRect(f-2,l-2,4,4)}t.globalAlpha=1}return this.canvasCache.set("explosion",e),e}createBulletSprite(){if(this.canvasCache.has("bullet"))return this.canvasCache.get("bullet");const e=document.createElement("canvas");e.width=4,e.height=8;const t=e.getContext("2d");return t.fillStyle="#00ffff",t.fillRect(0,0,4,8),this.canvasCache.set("bullet",e),e}createShotSound(){if(this.audioCache.has("shot"))return this.audioCache.get("shot");const e=new Audio,t=new(window.AudioContext||window.webkitAudioContext),i=t.createOscillator(),s=t.createGain();return i.type="square",i.frequency.setValueAtTime(800,t.currentTime),s.gain.setValueAtTime(.1,t.currentTime),s.gain.exponentialRampToValueAtTime(.01,t.currentTime+.1),i.connect(s),s.connect(t.destination),this.audioCache.set("shot",e),e}createExplosionSound(){if(this.audioCache.has("explosion"))return this.audioCache.get("explosion");const e=new Audio;return this.audioCache.set("explosion",e),e}createShortMovie(){const e=document.createElement("video");e.width=320,e.height=240,e.muted=!0,e.loop=!1;const t=document.createElement("canvas");t.width=320,t.height=240;const i=t.getContext("2d");return i.fillStyle="#000",i.fillRect(0,0,320,240),i.fillStyle="#fff",i.font="24px Arial",i.textAlign="center",i.fillText("VICTORY!",160,120),i.fillText("Thanks for playing!",160,160),t.toBlob(s=>{s&&(e.src=URL.createObjectURL(s))}),e}}class m{engine;assetManager;player;targets;bullets;lastShotTime=0;shotCooldown=200;constructor(e){this.engine=e,this.assetManager=h.getInstance(),this.player={x:0,y:0,width:32,height:32,vx:0,vy:0,hp:1,active:!0},this.targets=[],this.bullets=[]}init(){const e=this.engine.getCanvas();this.player.x=e.width/2-16,this.player.y=e.height-60,this.player.hp=1,this.player.active=!0,this.player.sprite=this.assetManager.createPlayerSprite(),this.targets=[{x:e.width/4-24,y:50,width:48,height:48,vx:0,vy:0,hp:10,active:!0,sprite:this.assetManager.createTargetSprite()},{x:e.width*3/4-24,y:50,width:48,height:48,vx:0,vy:0,hp:10,active:!0,sprite:this.assetManager.createTargetSprite()}],this.bullets=[],this.lastShotTime=0}update(e){const t=this.engine.getInputState(),i=this.engine.getCanvas();this.player.vx=0,t.left&&(this.player.vx=-5),t.right&&(this.player.vx=5),this.player.x+=this.player.vx,this.player.x=Math.max(0,Math.min(i.width-this.player.width,this.player.x)),t.shoot&&Date.now()-this.lastShotTime>this.shotCooldown&&(this.createBullet(),this.lastShotTime=Date.now()),this.bullets=this.bullets.filter(n=>(n.y+=n.vy,n.x+=n.vx,n.y<0||n.y>i.height||n.x<0||n.x>i.width?!1:n.active)),this.checkCollisions();const s=this.targets.filter(n=>n.active&&n.hp>0);if(s.length===0)this.engine.setState("result");else if(s.length===1){const n=this.targets.find(a=>!a.active||a.hp<=0);if(n){const a=n===this.targets[0]?"left":"right";this.engine.setGameResult(a),this.engine.setState("result")}}}createBullet(){this.bullets.push({x:this.player.x+this.player.width/2-2,y:this.player.y,vx:0,vy:-8,active:!0,sprite:this.assetManager.createBulletSprite()})}checkCollisions(){this.bullets.forEach(e=>{e.active&&this.targets.forEach(t=>{!t.active||t.hp<=0||this.isColliding(e,t)&&(e.active=!1,t.hp--,t.hp<=0&&(t.active=!1))})})}isColliding(e,t){return e.x<t.x+t.width&&e.x+4>t.x&&e.y<t.y+t.height&&e.y+8>t.y}render(e){const t=this.engine.getCanvas();e.fillStyle="#000",e.fillRect(0,0,t.width,t.height),e.fillStyle="#fff";for(let i=0;i<50;i++){const s=i*37%t.width,n=i*73%t.height;e.fillRect(s,n,1,1)}this.player.active&&this.player.sprite&&e.drawImage(this.player.sprite,this.player.x,this.player.y),this.targets.forEach(i=>{if(i.active&&i.sprite){e.drawImage(i.sprite,i.x,i.y);const s=40,n=4,a=i.x+(i.width-s)/2,r=i.y-10;e.fillStyle="#333",e.fillRect(a,r,s,n),e.fillStyle=i.hp>3?"#0f0":"#f00",e.fillRect(a,r,i.hp/10*s,n)}}),this.bullets.forEach(i=>{i.active&&i.sprite&&e.drawImage(i.sprite,i.x,i.y)})}cleanup(){this.bullets=[]}}class S{engine;startTime=0;duration=5e3;constructor(e){this.engine=e}init(){this.startTime=Date.now()}update(e){Date.now()-this.startTime>=this.duration&&this.engine.setState("movie")}render(e){const t=this.engine.getCanvas();e.fillStyle="#000",e.fillRect(0,0,t.width,t.height),e.fillStyle="#fff";for(let n=0;n<50;n++){const a=n*37%t.width,r=n*73%t.height;e.fillRect(a,r,1,1)}const i=this.engine.getGameResult();e.fillStyle="#00ff00",e.font="bold 36px Arial",e.textAlign="center",i==="left"?(e.fillText("You destroyed the",t.width/2,t.height/2-20),e.fillText("LEFT target!",t.width/2,t.height/2+20)):i==="right"?(e.fillText("You destroyed the",t.width/2,t.height/2-20),e.fillText("RIGHT target!",t.width/2,t.height/2+20)):e.fillText("Victory!",t.width/2,t.height/2),e.fillStyle="#fff",e.font="24px Arial",e.fillText("Well done, pilot!",t.width/2,t.height/2+80);const s=Math.ceil((this.duration-(Date.now()-this.startTime))/1e3);s>0&&(e.fillStyle="#666",e.font="16px Arial",e.fillText(`Next: ${s}s`,t.width/2,t.height-50))}cleanup(){}}class w{engine;assetManager;video=null;startTime=0;duration=1e4;animationFrame=0;constructor(e){this.engine=e,this.assetManager=h.getInstance()}init(){this.startTime=Date.now(),this.animationFrame=0;const e=document.getElementById("controls");e&&(e.style.display="none"),this.video=this.assetManager.createShortMovie()}update(e){const t=Date.now()-this.startTime;this.animationFrame+=e,t>=this.duration&&this.engine.setState("start")}render(e){const t=this.engine.getCanvas();e.fillStyle="#000",e.fillRect(0,0,t.width,t.height);const i=(Date.now()-this.startTime)/1e3;e.fillStyle="#fff";for(let l=0;l<100;l++){const u=(l*37+i*50)%t.width,d=(l*73+i*30)%t.height,p=Math.sin(i+l)*2+2;e.fillRect(u,d,p,p)}e.save(),e.translate(t.width/2,t.height/2),e.scale(1+Math.sin(i*2)*.1,1+Math.sin(i*2)*.1),e.fillStyle="#ffff00",e.font="bold 48px Arial",e.textAlign="center",e.fillText("VICTORY!",0,-20),e.fillStyle="#fff",e.font="24px Arial",e.fillText("Mission Accomplished",0,20),e.fillStyle="#0ff",e.font="20px Arial",e.fillText("Thanks for playing!",0,60),e.restore();for(let l=0;l<20;l++){const u=(i+l)*.5,d=50+Math.sin(i+l)*20,p=t.width/2+Math.cos(u)*d,v=t.height/2+Math.sin(u)*d;e.fillStyle=`hsl(${(i*100+l*20)%360}, 100%, 50%)`,e.fillRect(p-2,v-2,4,4)}const s=(Date.now()-this.startTime)/this.duration,n=t.width*.8,a=4,r=(t.width-n)/2,f=t.height-30;e.fillStyle="#333",e.fillRect(r,f,n,a),e.fillStyle="#0f0",e.fillRect(r,f,n*s,a)}cleanup(){const e=document.getElementById("controls");e&&(e.style.display="flex"),this.video&&(this.video.pause(),this.video=null)}}class T{canvas;ctx;inputManager;currentState="start";scenes=new Map;lastTime=0;animationId=0;gameResult=null;constructor(){this.canvas=document.getElementById("game-canvas"),this.ctx=this.canvas.getContext("2d"),this.inputManager=o.getInstance(),this.setupCanvas(),this.initializeScenes()}setupCanvas(){this.canvas.width=640,this.canvas.height=480,console.log("Canvas size:",this.canvas.width,"x",this.canvas.height)}initializeScenes(){this.scenes.set("start",new y(this)),this.scenes.set("game",new m(this)),this.scenes.set("result",new S(this)),this.scenes.set("movie",new w(this))}start(){this.inputManager.init(),this.setState("start"),this.gameLoop(0)}gameLoop=e=>{const t=e-this.lastTime;this.lastTime=e,this.update(t),this.render(),this.animationId=requestAnimationFrame(this.gameLoop)};update(e){const t=this.scenes.get(this.currentState);t&&t.update(e)}render(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height);const e=this.scenes.get(this.currentState);e&&e.render(this.ctx)}setState(e){const t=this.scenes.get(this.currentState);t&&t.cleanup(),this.currentState=e;const i=this.scenes.get(e);i&&i.init()}getInputState(){return this.inputManager.getInputState()}getCanvas(){return this.canvas}getContext(){return this.ctx}setGameResult(e){this.gameResult=e}getGameResult(){return this.gameResult}async requestFullscreen(){try{this.canvas.requestFullscreen?await this.canvas.requestFullscreen():this.canvas.webkitRequestFullscreen?await this.canvas.webkitRequestFullscreen():this.canvas.msRequestFullscreen&&await this.canvas.msRequestFullscreen()}catch(e){console.warn("Fullscreen request failed:",e)}}destroy(){this.animationId&&cancelAnimationFrame(this.animationId),this.scenes.forEach(e=>e.cleanup()),this.scenes.clear()}}const g=new T;g.start();window.addEventListener("beforeunload",()=>{g.destroy()});
